C51 COMPILER V9.54   INTERRUPT                                                             01/07/2019 09:57:11 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE INTERRUPT
OBJECT MODULE PLACED IN .\Objects\Interrupt.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE USER\Interrupt.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\USER;.\START;.\Hardwa
                    -re\IO_FUNC;.\Hardware\USART;.\Hardware\TIM) DEBUG OBJECTEXTEND PRINT(.\Listings\Interrupt.lst) TABS(2) OBJECT(.\Objects\
                    -Interrupt.obj)

line level    source

   1          #include "main.h"
   2          
   3          bit usart1_busy;
   4          bit usart3_busy;
   5          
   6          /***********************************************************************************************
   7          *函数名 ： void Uart() interrupt 4  
   8          *函数功能描述 ：主机串口接收中断 
   9          *函数参数 ： NONE
  10          *函数返回值 ： void
  11          *作者 ：WangR
  12          *函数创建日期 ： 20190106
  13          *函数修改日期 ： --
  14          *修改人 ：--
  15          *修改原因 ： --
  16          *版本 ： 1.0
  17          *历史版本 ： --
  18          ***********************************************************************************************/
  19          void Uart() interrupt 4   //串口接收解码
  20          {
  21   1          if (RI)
  22   1          {
  23   2              if(Rec_Finish == False)
  24   2              {
  25   3                T4T3M &= ~0x02;                 //定时器3为12T模式
  26   3                T3L = 35536;                 //初始化计时值 
  27   3                T3H = 35536 >> 8;
  28   3                T4T3M |= 0x08;                  //定时器3开始计时
  29   3                IE2 |= 0x20;                    //开定时器3中断
  30   3              
  31   3                Rec_Buff[Rec_Len] = SBUF;
  32   3                Rec_Len ++; 
  33   3                if(Rec_Len == 8)
  34   3                {
  35   4                  if(Rec_Buff[0] == 0xa5 && Rec_Buff[0] == 0x5a)
  36   4                  {
  37   5                    Rec_Len = 0;
  38   5                    Rec_Finish = True;
  39   5                    IE2 &= ~0x20;   //关定时器3中断
  40   5                  }
  41   4                  else
  42   4                  {
  43   5                    memset(Rec_Buff , 0 , sizeof(Rec_Buff));
  44   5                    Rec_Len = 0;
  45   5                    Rec_Finish = False;
  46   5                    IE2 &= ~0x20;   //关定时器3中断
  47   5                  }
  48   4                }
  49   3              }
  50   2              RI = 0;                 //清除RI位
  51   2          }
  52   1          if (TI)
  53   1          {
C51 COMPILER V9.54   INTERRUPT                                                             01/07/2019 09:57:11 PAGE 2   

  54   2              TI = 0;                 //清除TI位
  55   2              usart1_busy = 0;
  56   2          }
  57   1      }
  58          /***********************************************************************************************
  59          *函数名 ： void Uart3() interrupt 17
  60          *函数功能描述 ：从机串口接收中断 
  61          *函数参数 ： NONE
  62          *函数返回值 ： void
  63          *作者 ：WangR
  64          *函数创建日期 ： 20190106
  65          *函数修改日期 ： --
  66          *修改人 ：--
  67          *修改原因 ： --
  68          *版本 ： 1.0
  69          *历史版本 ： --
  70          ***********************************************************************************************/
  71          void Uart3() interrupt 17
  72          {
  73   1          if (S3CON & S3RI)
  74   1          {
  75   2              S3CON &= ~S3RI;         //清除S3RI位
  76   2              P0 = S3BUF;             //P0显示串口数据
  77   2              P2 = (S3CON & S3RB8);   //P2.2显示校验位
  78   2          }
  79   1          if (S3CON & S3TI)
  80   1          {
  81   2              S3CON &= ~S3TI;         //清除S3TI位
  82   2              usart3_busy = 0;
  83   2          }
  84   1      }
  85          /***********************************************************************************************
  86          *函数名 ： void t3int() interrupt 19 
  87          *函数功能描述 ：定时器3中断
  88          *函数参数 ： NONE
  89          *函数返回值 ： void
  90          *作者 ：WangR
  91          *函数创建日期 ： 20190106
  92          *函数修改日期 ： --
  93          *修改人 ：--
  94          *修改原因 ： --
  95          *版本 ： 1.0
  96          *历史版本 ： --
  97          ***********************************************************************************************/
  98          void t3int() interrupt 19           //中断入口
  99          {
 100   1        Rec_Len = 0;
 101   1        Rec_Finish = False; 
 102   1        memset(Rec_Buff , 0 , sizeof(Rec_Buff));  
 103   1        IE2 &= ~0x20;                   //若需要手动清除中断标志,可先关闭中断,此时系统会
             -动清除内部的中断标志
 104   1      
 105   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    254    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10    ----
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.54   INTERRUPT                                                             01/07/2019 09:57:11 PAGE 3   

   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
